<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: headerParams('Tableau de Bord UASZ')}"></head>
<body>
<nav th:replace="~{fragments/layout :: sidebar(activePage='accueil')}"></nav>

<main class="main-content">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-dark">Tableau de Bord</h2>
            <p class="text-muted mb-0">Pilotage global des enseignements et de la structure.</p>
        </div>
        <div>
            <a th:href="@{/enseignants/export/pdf}" class="btn btn-outline-danger btn-sm shadow-sm">
                <i class="bi bi-file-pdf-fill me-2"></i>Rapport
            </a>
            <span class="badge bg-success bg-opacity-10 text-success px-3 py-2 ms-2 border border-success">
                <i class="bi bi-calendar-check me-2"></i>2024-2025
            </span>
        </div>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-4 col-xl-2">
            <div class="card border-0 shadow-sm text-center h-100 border-top border-4 border-success">
                <div class="card-body">
                    <h2 class="fw-bold mb-0 text-dark" th:text="${stats.totalEnseignants}">0</h2>
                    <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Enseignants</small>
                </div>
            </div>
        </div>
        <div class="col-md-4 col-xl-2">
            <div class="card border-0 shadow-sm text-center h-100 border-top border-4 border-info">
                <div class="card-body">
                    <h2 class="fw-bold mb-0 text-dark" th:text="${stats.totalFilieres}">0</h2>
                    <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Filières</small>
                </div>
            </div>
        </div>
        <div class="col-md-4 col-xl-2">
            <div class="card border-0 shadow-sm text-center h-100 border-top border-4 border-primary">
                <div class="card-body">
                    <h2 class="fw-bold mb-0 text-dark" th:text="${stats.totalFormations}">0</h2>
                    <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Formations</small>
                </div>
            </div>
        </div>
        <div class="col-md-4 col-xl-2">
            <div class="card border-0 shadow-sm text-center h-100 border-top border-4 border-warning">
                <div class="card-body">
                    <h2 class="fw-bold mb-0 text-dark" th:text="${stats.totalClasses}">0</h2>
                    <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Classes</small>
                </div>
            </div>
        </div>
        <div class="col-md-4 col-xl-2">
            <div class="card border-0 shadow-sm text-center h-100 border-top border-4 border-danger">
                <div class="card-body">
                    <h2 class="fw-bold mb-0 text-dark" th:text="${stats.totalUes}">0</h2>
                    <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Unités (UE)</small>
                </div>
            </div>
        </div>
        <div class="col-md-4 col-xl-2">
            <div class="card border-0 shadow-sm text-center h-100 border-top border-4 border-secondary">
                <div class="card-body">
                    <h2 class="fw-bold mb-0 text-dark" th:text="${stats.totalEcs}">0</h2>
                    <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Éléments (EC)</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white py-3 border-bottom">
                    <h6 class="mb-0 fw-bold text-success"><i class="bi bi-person-badge me-2"></i>Répartition par Grade</h6>
                </div>
                <div class="card-body">
                    <canvas id="gradeChart" height="250"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white py-3 border-bottom">
                    <h6 class="mb-0 fw-bold text-info"><i class="bi bi-pie-chart me-2"></i>Poids des Filières</h6>
                </div>
                <div class="card-body">
                    <div style="max-height: 250px; position: relative;">
                        <canvas id="filiereChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white py-3 border-bottom d-flex justify-content-between align-items-center">
                    <h6 class="mb-0 fw-bold text-primary"><i class="bi bi-clock-history me-2"></i>Répartition du Volume Horaire Global</h6>
                    <span class="badge bg-light text-dark border">Prévisionnel Semestre 1</span>
                </div>
                <div class="card-body">
                    <canvas id="volumeChart" height="80"></canvas> </div>
                <div class="card-footer bg-light small text-muted">
                    Ce graphique représente la charge d'enseignement totale (Cumul CM + TD + TP) planifiée dans les maquettes.
                </div>
            </div>
        </div>
    </div>

</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script th:inline="javascript">
    // --- 1. CHART GRADES (Barres Verticales) ---
    const dataGrades = [[${stats.repartitionParGrade}]];
    new Chart(document.getElementById('gradeChart'), {
        type: 'bar',
        data: {
            labels: Object.keys(dataGrades),
            datasets: [{
                label: 'Enseignants',
                data: Object.values(dataGrades),
                backgroundColor: 'rgba(26, 94, 52, 0.8)', // Vert UASZ
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } },
            plugins: { legend: { display: false } }
        }
    });

    // --- 2. CHART FILIERES (Doughnut) ---
    const dataFilieres = [[${stats.repartitionParFiliere}]];
    new Chart(document.getElementById('filiereChart'), {
        type: 'doughnut',
        data: {
            labels: Object.keys(dataFilieres),
            datasets: [{
                data: Object.values(dataFilieres),
                backgroundColor: [
                    '#0d6efd', '#6610f2', '#6f42c1', '#d63384', '#dc3545', '#fd7e14'
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'right' }
            }
        }
    });

    // --- 3. CHART VOLUME HORAIRE (Barres Horizontales) ---
    const dataVolume = [[${stats.volumeHoraireGlobal}]];
    new Chart(document.getElementById('volumeChart'), {
        type: 'bar',
        indexAxis: 'y', // Rend le graphique horizontal
        data: {
            labels: Object.keys(dataVolume),
            datasets: [{
                label: 'Heures planifiées',
                data: Object.values(dataVolume),
                backgroundColor: [
                    'rgba(255, 193, 7, 0.8)', // Jaune pour CM
                    'rgba(13, 202, 240, 0.8)', // Bleu ciel pour TD
                    'rgba(32, 201, 151, 0.8)'  // Vert d'eau pour TP
                ],
                borderColor: [
                    'rgba(255, 193, 7, 1)',
                    'rgba(13, 202, 240, 1)',
                    'rgba(32, 201, 151, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { x: { beginAtZero: true } }
        }
    });
</script>

</body>
</html>