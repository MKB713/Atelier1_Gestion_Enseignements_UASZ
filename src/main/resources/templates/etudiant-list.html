<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/layout :: headerParams('Liste des Étudiants - UASZ')}"></head>

<body>

<nav th:replace="~{fragments/layout :: sidebar(activePage='etudiants')}"></nav>

<main class="main-content">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-dark">Liste des Étudiants</h2>
            <p class="text-muted mb-0">Gestion des étudiants inscrits</p>
        </div>
        <div>
            <span class="badge bg-primary me-2 px-3 py-2">
                <i class="bi bi-people-fill me-2"></i>Total: <span th:text="${totalEtudiants}">0</span>
            </span>
            <span class="badge bg-success me-2 px-3 py-2">
                <i class="bi bi-check-circle me-2"></i>Actifs: <span th:text="${etudiantsActifs}">0</span>
            </span>
            <a href="/add-etudiant" th:href="@{/add-etudiant}" class="btn btn-success shadow-sm">
                <i class="bi bi-plus-circle me-2"></i>Nouvel Étudiant
            </a>
        </div>
    </div>

    <div th:if="${success}" class="alert alert-success alert-dismissible fade show shadow-sm" role="alert">
        <i class="bi bi-check-circle me-2"></i>
        <span th:text="${success}">Success message</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show shadow-sm" role="alert">
        <i class="bi bi-exclamation-triangle me-2"></i>
        <span th:text="${error}">Error message</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="card border-0 shadow-sm">
        <div class="card-header bg-white py-3">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h5 class="mb-0 fw-bold text-success">
                        <i class="bi bi-person-badge me-2"></i>Étudiants Enregistrés
                    </h5>
                </div>
                <div class="col-md-6">
                    <input type="text" id="searchInput" class="form-control"
                           placeholder="Rechercher par nom, prénom ou matricule...">
                </div>
            </div>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Matricule</th>
                            <th>Nom Complet</th>
                            <th>Email</th>
                            <th>Téléphone</th>
                            <th>Date Naissance</th>
                            <th>Statut</th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="etudiantTableBody">
                        <tr th:if="${etudiants == null or #lists.isEmpty(etudiants)}">
                            <td colspan="7" class="text-center py-4 text-muted">
                                <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                                Aucun étudiant enregistré
                            </td>
                        </tr>
                        <tr th:each="etudiant : ${etudiants}">
                            <td class="fw-bold text-primary">
                                <span th:text="${etudiant.matricule}">MAT001</span>
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="avatar-circle bg-success text-white me-2">
                                        <span th:text="${#strings.substring(etudiant.prenom, 0, 1) + #strings.substring(etudiant.nom, 0, 1)}">AB</span>
                                    </div>
                                    <span th:text="${etudiant.prenom + ' ' + etudiant.nom}">Nom Complet</span>
                                </div>
                            </td>
                            <td>
                                <small th:text="${etudiant.email}">email@example.com</small>
                            </td>
                            <td th:text="${etudiant.telephone}">-</td>
                            <td th:text="${etudiant.dateNaissance != null ? #temporals.format(etudiant.dateNaissance, 'dd/MM/yyyy') : '-'}">-</td>
                            <td>
                                <span class="badge"
                                      th:classappend="${etudiant.statut.name() == 'ACTIF'} ? 'bg-success' :
                                                      (${etudiant.statut.name() == 'SUSPENDU'} ? 'bg-warning' :
                                                      (${etudiant.statut.name() == 'DIPLOME'} ? 'bg-info' : 'bg-danger'))"
                                      th:text="${etudiant.statut}">ACTIF</span>
                            </td>
                            <td class="text-center">
                                <a th:href="@{/view-etudiant/{id}(id=${etudiant.id})}"
                                   class="btn btn-sm btn-outline-info" title="Voir détails">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <a th:href="@{/edit-etudiant/{id}(id=${etudiant.id})}"
                                   class="btn btn-sm btn-outline-primary" title="Modifier">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a th:href="@{/add-inscription?etudiantId={id}(id=${etudiant.id})}"
                                   class="btn btn-sm btn-outline-success" title="Inscrire">
                                    <i class="bi bi-plus-square"></i>
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Recherche dynamique
    document.getElementById('searchInput').addEventListener('keyup', function() {
        const searchTerm = this.value.toLowerCase();
        const rows = document.querySelectorAll('#etudiantTableBody tr');

        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
    });
</script>

<style>
    .avatar-circle {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 0.8rem;
    }
</style>

</body>
</html>
